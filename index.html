<!DOCTYPE html>
<html lang="ja"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InTEx: Interactive TExt gallery </title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
            margin: 0;
            padding: 40px 20px;
            background: #fafafa;
            min-height: 100vh;
            color: #222;
            line-height: 1.7;
        }
        
        .container {
            max-width: 860px;
            margin: 0 auto;
            background: #fff;
            padding: 50px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        
        h1 {
            color: #fff;
            text-align: center;
            margin-bottom: 12px;
            font-size: 5rem;
            font-weight: 800;
            letter-spacing: 0.05em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            text-align: center;
            color: rgba(255,255,255,0.85);
            margin-bottom: 12px;
            font-size: 16px;
            letter-spacing: 0.1em;
        }
        
        .credits {
            text-align: center;
            color: rgba(255,255,255,0.7);
            margin-bottom: 16px;
            font-size: 13px;
        }
        .credits a {
            color: #f8bbd9;
            text-decoration: none;
        }
        .credits a:hover {
            text-decoration: underline;
        }
        
        .header-section {
            background: linear-gradient(135deg, #4a1528 0%, #722f37 100%);
            margin: -50px -50px 40px -50px;
            padding: 40px 50px;
            border-radius: 4px 4px 0 0;
        }
        
            text-align: center;
            margin-bottom: 40px;
        }
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #333;
            text-decoration: none;
            font-weight: 500;
            font-size: 13px;
            padding: 10px 20px;
            background: #fff;
            border-radius: 4px;
            transition: all 0.2s ease;
            border: 1px solid #ddd;
        }
            border-color: #c00;
            color: #c00;
        }
            content: '‚ñ∂';
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            background: #c00;
            color: #fff;
            border-radius: 4px;
            font-size: 10px;
            padding-left: 2px;
        }
        
        /* „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Çª„ÇØ„Ç∑„Éß„É≥ */
        .upload-section {
            background: #fff;
            border: 1px solid #e0e0e0;
            padding: 32px;
            border-radius: 4px;
            margin-bottom: 32px;
        }
        
        .upload-section h2 {
            color: #111;
            margin-top: 0;
            margin-bottom: 24px;
            font-size: 16px;
            font-weight: 600;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
        }
        
        .upload-group {
            margin-bottom: 24px;
        }
        
        .upload-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #333;
            font-size: 13px;
        }
        
        .file-input, .text-input {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: #fff;
            color: #222;
            transition: border-color 0.2s;
        }
        
        .file-input:hover, .text-input:hover,
        .file-input:focus, .text-input:focus {
            border-color: #999;
            outline: none;
        }
        
        .file-input::file-selector-button {
            background: #333;
            color: #fff;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            font-size: 13px;
            cursor: pointer;
            margin-right: 12px;
            transition: background 0.2s;
        }
        
        .file-input::file-selector-button:hover {
            background: #111;
        }
        
        .process-button {
            background: #111;
            color: #fff;
            border: none;
            padding: 14px 48px;
            font-size: 14px;
            font-weight: 600;
            border-radius: 4px;
            cursor: pointer;
            display: block;
            margin: 32px auto 0;
            transition: all 0.2s ease;
        }
        
        .process-button:hover:not(:disabled) {
            background: #333;
        }
        
        .process-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çª„ÇØ„Ç∑„Éß„É≥ */
        .content-section {
            display: none;
        }
        
        .gloss-info-banner {
            background: #f8f8f8;
            border-left: 3px solid #333;
            padding: 14px 18px;
            margin-bottom: 24px;
            font-size: 13px;
            color: #555;
        }
        
        .gloss-info-banner strong {
            color: #222;
        }
        
        .gloss-info-banner a {
            color: #333;
            text-decoration: underline;
        }
        
        .status-bar {
            background: #f8f8f8;
            padding: 14px 18px;
            border-radius: 4px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }
        
        .status-info {
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-info span {
            color: #111;
            font-weight: 600;
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #333;
        }
        
        /* ÈÄ£Á∂öÂÜçÁîü„Ç≥„É≥„Éà„É≠„Éº„É´ */
        .playback-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 32px;
            gap: 12px;
        }
        
        .play-all-button, .download-button {
            background: #fff;
            color: #333;
            border: 1px solid #ddd;
            padding: 12px 24px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
        }
        
        .play-all-button:hover, .download-button:hover {
            border-color: #333;
            background: #333;
            color: #fff;
        }
        
        .play-all-button.playing {
            background: #333;
            color: #fff;
            border-color: #333;
        }
        
        .play-all-button .button-icon, .download-button .button-icon {
            font-size: 14px;
        }
        
        /* ‰æãÊñá„É™„Çπ„Éà */
        .example-list {
            margin-top: 24px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .example-list::-webkit-scrollbar {
            width: 6px;
        }
        
        .example-list::-webkit-scrollbar-track {
            background: #f0f0f0;
        }
        
        .example-list::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        
        .example-item {
            margin: 0;
            padding: 20px 24px;
            background: #fff;
            cursor: pointer;
            transition: background 0.2s ease;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        
        .example-item:first-child {
            border-top: 1px solid #eee;
        }
        
        .example-item:hover {
            background: #f8f8f8;
        }
        
        .example-item.playing {
            background: #f0f0f0;
        }
        
        .example-number {
            font-weight: 600;
            color: #333;
            margin-right: 12px;
            font-size: 14px;
        }
        
        .interlinear-container {
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
            line-height: 1.8;
            overflow-x: auto;
            white-space: nowrap;
        }
        
        .interlinear-row {
            display: flex;
            align-items: flex-start;
            gap: 0.5em;
        }
        
        .word-group {
            display: inline-flex;
            flex-direction: column;
            align-items: flex-start;
            margin-right: 0.5em;
        }
        
        .original-word {
            font-size: 16px;
            color: #111;
            font-weight: 500;
            font-family: Georgia, 'Times New Roman', serif;
        }
        
        .gloss-word {
            font-size: 13px;
            color: #666;
            font-variant: small-caps;
            font-family: 'Courier New', monospace;
        }
        
        .gloss-clickable {
            cursor: pointer;
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 2px;
            color: #333;
            font-weight: 600;
            transition: color 0.2s ease;
        }
        
        .gloss-clickable:hover {
            color: #000;
        }
        
        .translation-text {
            font-size: 14px;
            color: #555;
            line-height: 1.6;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
            white-space: normal;
        }
        
        .play-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 40px;
            background: #f0f0f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .example-item:hover .play-icon {
            background: #333;
            color: #fff;
        }
        
        .example-item.playing .play-icon {
            background: #333;
            color: #fff;
        }
        
        /* „Ç∞„É≠„ÇπÂêπ„ÅçÂá∫„Åó */
        .gloss-tooltip {
            position: fixed;
            background: #111;
            color: #fff;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 13px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 280px;
            opacity: 0;
            transform: translateY(-8px);
            transition: opacity 0.2s ease, transform 0.2s ease;
            pointer-events: none;
        }
        
        .gloss-tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .gloss-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #111 transparent transparent transparent;
        }
        
        .gloss-tooltip-title {
            font-weight: 600;
            color: #fff;
            margin-bottom: 4px;
        }
        
        /* „Ç™„Éº„Éá„Ç£„Ç™„Éó„É¨„Éº„É§„Éº */
        #audioPlayer {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #111;
            padding: 16px 24px;
            border-radius: 4px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            display: none;
            align-items: center;
            gap: 16px;
            color: #fff;
            font-size: 13px;
        }
        
        #audioPlayer.active {
            display: flex;
        }
        
        .audio-progress {
            width: 160px;
            height: 4px;
            background-color: #444;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .audio-progress-bar {
            height: 100%;
            background: #fff;
            width: 0%;
            transition: width 0.1s linear;
        }
        
        /* „Çπ„ÉÜ„Éº„Çø„Çπ„É°„ÉÉ„Çª„Éº„Ç∏ */
        .status-message {
            margin-top: 16px;
            padding: 12px 16px;
            border-radius: 4px;
            font-size: 13px;
            text-align: center;
            display: none;
        }
        
        .status-message.info {
            background: #f0f0f0;
            color: #333;
            display: block;
        }
        
        .status-message.success {
            background: #f0f0f0;
            color: #333;
            display: block;
        }
        
        .status-message.error {
            background: #fef2f2;
            color: #991b1b;
            display: block;
        }
        
        /* ZenodoÂèñÂæóÊ©üËÉΩ */
        .zenodo-section {
            margin-top: 12px;
            padding: 18px;
            background: #f8f8f8;
            border-radius: 4px;
        }
        .zenodo-section label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
            font-weight: 500;
        }
        .zenodo-row {
            display: flex;
            gap: 8px;
        }
        .zenodo-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            background: #fff;
            color: #222;
            transition: border-color 0.2s;
        }
        .zenodo-input:focus {
            outline: none;
            border-color: #999;
        }
        .zenodo-input::placeholder {
            color: #aaa;
        }
        .zenodo-btn {
            padding: 10px 20px;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            transition: background 0.2s;
        }
        .zenodo-btn:hover {
            background: #111;
        }
        .zenodo-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .zenodo-status {
            font-size: 12px;
            margin-top: 10px;
            color: #666;
        }
        .zenodo-status.success {
            color: #166534;
        }
        .zenodo-status.error {
            color: #991b1b;
        }
        .manual-url-section {
            margin-top: 18px;
            padding-top: 18px;
            border-top: 1px solid #e0e0e0;
        }
        .manual-url-section label {
            color: #888 !important;
        }
        .manual-url-textarea {
            width: 100%;
            height: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            resize: vertical;
            background: #fff;
            color: #222;
            transition: border-color 0.2s;
        }
        .manual-url-textarea:focus {
            outline: none;
            border-color: #999;
        }
        .manual-url-textarea::placeholder {
            color: #aaa;
        }
        .manual-url-count {
            font-size: 12px;
            color: #888;
            margin-top: 8px;
        }
        .manual-url-count.has-urls {
            color: #166534;
        }
        
        /* small text */
        small {
            color: #888 !important;
            font-size: 12px;
        }
        
        audio {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header-section">
            <h1 id="pageTitle">„ÉÜ„Çπ„Éà</h1>
            <div class="subtitle" id="pageSubtitle">Interactive Text Gallery Generator for Field Linguists</div>
            <div class="credits">¬© Michinori Shimoji (<a href="https://mshimoji.com" target="_blank">mshimoji.com</a>) | DOI: <a href="https://doi.org/10.5281/zenodo.16732543" target="_blank">10.5281/zenodo.16732543</a></div>
        </div>
        
        
        
        <!-- „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Çª„ÇØ„Ç∑„Éß„É≥ -->
        
        
        <!-- „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="content-section" id="contentSection" style="display: block;">
            <div class="gloss-info-banner">
                <strong>„Ç∞„É≠„Çπ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÄÅÂíåË®≥„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</strong>
                Ôºà<a href="https://michinorishimoji.github.io/searchgloss/" target="_blank">SearchGloss</a>„Å´Âü∫„Å•„Åè„Ç∞„É≠„ÇπËæûÊõ∏„ÇíÂÜÖËîµÔºâ
            </div>
            
            <div class="status-bar">
                <div class="status-info">
                    <div class="status-indicator"></div>
                    „Çπ„ÉÜ„Éº„Çø„Çπ: <span id="statusText">Ê∫ñÂÇôÂÆå‰∫Ü</span>
                </div>
                <div class="status-info">
                    ‰æãÊñáÊï∞: <span id="exampleCount">4</span>
                </div>
            </div>
            
            <div class="playback-controls">
                <button id="playAllBtn" class="play-all-button" style="display: none;">
                    <span class="button-icon">‚ñ∂</span>
                    <span class="button-text">ÂÖ®‰ΩìÈü≥Â£∞„ÇíÂÜçÁîü</span>
                </button>
                <button id="downloadBtn" class="download-button">
                    <span class="button-icon">‚¨á</span>
                    <span class="button-text">HTML„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ</span>
                </button>
            </div>
            
            <div class="example-list" id="exampleList"></div>
        </div>
        
        <!-- „Ç™„Éº„Éá„Ç£„Ç™„Éó„É¨„Éº„É§„Éº -->
        <div id="audioPlayer">
            <span>ÂÜçÁîü‰∏≠Ôºö</span>
            <span id="currentExample"></span>
            <div class="audio-progress">
                <div class="audio-progress-bar" id="progressBar"></div>
            </div>
        </div>
        
        <audio id="audio" crossorigin="anonymous"></audio>
        
        <!-- „Ç∞„É≠„ÇπÂêπ„ÅçÂá∫„Åó -->
        <div class="gloss-tooltip" id="glossTooltip">
            <div class="gloss-tooltip-content">
                <div class="gloss-tooltip-title" id="glossTitle"></div>
                <div id="glossDescription"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
                    // Âüã„ÇÅËæº„Åæ„Çå„Åü„Éá„Éº„Çø
                    window.embeddedData = {
                        examples: [{"id":1,"original":"nkjaan=ca","gloss":"Êòî=HS","japanese":"Êòî„ÄÖ„ÅÆ„Åì„Å®„Å†„Å®„Åï„ÄÇ"},{"id":2,"original":"nkjaan=du anna=tu uja=tu tamamiga=ti as…® ffa-gama=nu u-tar=ca","gloss":"Êòî=FOC ÊØçË¶™=COM Áà∂Ë¶™=COM „Çø„Éû„Éü„Ç¨=QUOT Ë®Ä„ÅÜ Â≠ê-DIM=NOM „ÅÑ„Çã-PST=HS","japanese":"Êòî„ÄÖ„ÄÅÊØçË¶™„Å®Áà∂Ë¶™„Å®„Çø„Éû„Éü„Ç¨„Å®„ÅÑ„ÅÜÂ≠ê‰æõ„Åå„ÅÑ„Åü„Çì„Å†„Å®„Åï„ÄÇ"},{"id":3,"original":"unu ffa-gama=a dondon dondon aparagi-midum-mas-i-i sudac-i-i","gloss":"„Åù„ÅÆ Â≠ê-DIM=TOP ONM ONM Áæé„Åó„ÅÑ-Â•≥-CVLZ-THM-SEQ ËÇ≤„Å§-THM-SEQ","japanese":"„Åù„ÅÆÂ≠ê‰æõ„ÅØ„Å©„Çì„Å©„Çì„Å©„Çì„Å©„ÇìÁæé„Åó„ÅÑÂ•≥„Å´ËÇ≤„Å£„Å¶"},{"id":4,"original":"mura=kara=mai icban aparagi-munu=n mmja uu-f…® nar-i-i nar-i-u-tar=ca","gloss":"Êùë=ABL=ADD ‰∏ÄÁï™ Áæé„Åó„ÅÑ-ADJ=DAT DSC Â§ß„Åç„ÅÑ-VLZ „Å™„Çã-THM-SEQ „Å™„Çã-THM-PROG-PST=HS","japanese":"Êùë„Åß„ÇÇ‰∏ÄÁï™„ÅÆÁæé‰∫∫„Å´ÊàêÈï∑„Åó„Åü„Çì„Å†„Å®„Åï„ÄÇ"}],
                        audioUrls: ["https://zenodo.org/api/records/17774723/files/001_nkjaanca.wav/content?download=1","https://zenodo.org/api/records/17774723/files/002_nkjaandu_annatu_ujatu_tamam.wav/content?download=1","https://zenodo.org/api/records/17774723/files/003_unu_ffa-gamaa_dondon_dondon_a.wav/content?download=1","https://zenodo.org/api/records/17774723/files/004_murakaramai_icban_aparagi-mu.wav/content?download=1"],
                        fullAudioUrl: ""
                    };
                </script><script>
        // PDFjs worker„ÅÆË®≠ÂÆö
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let examples = [];
        let audioUrls = [];
        let fullAudioUrl = '';
        let currentlyPlaying = null;
        let useCorsProxy = true; // CORS„Éó„É≠„Ç≠„Ç∑„Çí‰ΩøÁî®„Åô„Çã„Åã„Å©„ÅÜ„Åã
        
        // Zenodo„É¨„Ç≥„Éº„ÉâURL„Åã„ÇâÈü≥Â£∞„Éï„Ç°„Ç§„É´URL„ÇíÂèñÂæó
        async function fetchZenodoFiles(recordUrl) {
            // Zenodo„ÅÆ„É¨„Ç≥„Éº„ÉâURL„Åã„Çâ„É¨„Ç≥„Éº„ÉâID„ÇíÊäΩÂá∫
            const match = recordUrl.match(/zenodo\.org\/records\/(\d+)/);
            if (!match) {
                throw new Error('ÁÑ°Âäπ„Å™Zenodo URL„Åß„Åô„ÄÇ‰æã: https://zenodo.org/records/12345678');
            }
            
            const recordId = match[1];
            const apiUrl = `https://zenodo.org/api/records/${recordId}`;
            
            // CORS„Éó„É≠„Ç≠„Ç∑„ÇíË©¶Ë°åÔºàË§áÊï∞„ÅÆ„Éó„É≠„Ç≠„Ç∑„ÇíÈ†ÜÁï™„Å´Ë©¶„ÅôÔºâ
            const proxyUrls = [
                apiUrl, // „Åæ„ÅöÁõ¥Êé•„Ç¢„ÇØ„Çª„Çπ„ÇíË©¶„Åø„Çã
                `https://corsproxy.io/?${encodeURIComponent(apiUrl)}`,
                `https://api.allorigins.win/get?url=${encodeURIComponent(apiUrl)}`,
                `https://thingproxy.freeboard.io/fetch/${apiUrl}`,
                `https://cors.bridged.cc/${apiUrl}`
            ];
            
            let data = null;
            let lastError = null;
            
            for (const url of proxyUrls) {
                try {
                    console.log('Trying:', url);
                    const response = await fetch(url);
                    if (response.ok) {
                        let jsonData = await response.json();
                        // allorigins„ÅØcontents„Éï„Ç£„Éº„É´„Éâ„Å´„Éá„Éº„Çø„Çí„É©„ÉÉ„Éó„Åô„Çã
                        if (jsonData.contents) {
                            jsonData = JSON.parse(jsonData.contents);
                        }
                        data = jsonData;
                        console.log('Success with:', url);
                        break;
                    }
                } catch (e) {
                    lastError = e;
                    console.log(`Proxy failed: ${url}`, e.message);
                }
            }
            
            if (!data) {
                throw new Error('Zenodo API„Å∏„ÅÆÊé•Á∂ö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇCORS„Éó„É≠„Ç≠„Ç∑„Åå„Åô„Åπ„Å¶Âà©Áî®‰∏çÂèØ„Åß„Åô„ÄÇ');
            }
            
            if (!data.files || data.files.length === 0) {
                throw new Error('„Åì„ÅÆ„É¨„Ç≥„Éº„Éâ„Å´„ÅØ„Éï„Ç°„Ç§„É´„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
            }
            
            // Èü≥Â£∞„Éï„Ç°„Ç§„É´„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const audioExtensions = ['.wav', '.mp3', '.ogg', '.flac', '.m4a'];
            const audioFiles = data.files.filter(f => {
                const ext = f.key.toLowerCase().substring(f.key.lastIndexOf('.'));
                return audioExtensions.includes(ext);
            });
            
            if (audioFiles.length === 0) {
                throw new Error('Èü≥Â£∞„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„ÇìÔºà.wav, .mp3„Å™„Å©Ôºâ');
            }
            
            // ÂÄãÂà•Èü≥Â£∞Ôºà001_, 002_„Å™„Å©Ôºâ„Å®ÂÖ®‰ΩìÈü≥Â£∞Ôºàtext_„Å™„Å©Ôºâ„ÇíÂàÜÈõ¢
            const individualFiles = [];
            let fullAudioFile = null;
            
            for (const f of audioFiles) {
                const filename = f.key;
                // Êï∞Â≠ó3Ê°Å_„ÅßÂßã„Åæ„Çã„Éï„Ç°„Ç§„É´„ÅØÂÄãÂà•Èü≥Â£∞
                if (/^\d{3}_/.test(filename)) {
                    individualFiles.push(f);
                } 
                // text_„ÅßÂßã„Åæ„Çã„ÄÅ„Åæ„Åü„ÅØ "full" „ÇíÂê´„ÇÄ„Éï„Ç°„Ç§„É´„ÅØÂÖ®‰ΩìÈü≥Â£∞
                else if (/^text_/i.test(filename) || /full/i.test(filename)) {
                    fullAudioFile = f;
                }
                // „Åù„Çå‰ª•Â§ñ„ÅßÁï™Âè∑„ÅåÂê´„Åæ„Çå„Å™„ÅÑ„Éï„Ç°„Ç§„É´„ÇÇÂÖ®‰ΩìÈü≥Â£∞ÂÄôË£ú
                else if (!/\d{3}/.test(filename)) {
                    fullAudioFile = f;
                }
                // „Åù„Çå‰ª•Â§ñ„ÅØÂÄãÂà•Èü≥Â£∞„Å®„Åó„Å¶Êâ±„ÅÜ
                else {
                    individualFiles.push(f);
                }
            }
            
            // „Éï„Ç°„Ç§„É´Âêç„Åß„ÇΩ„Éº„ÉàÔºà001_, 002_„Å™„Å©„ÅÆÁï™Âè∑È†ÜÔºâ
            individualFiles.sort((a, b) => a.key.localeCompare(b.key, undefined, { numeric: true }));
            
            // „ÉÄ„Ç¶„É≥„É≠„Éº„ÉâURL„ÇíÁîüÊàê
            const individualUrls = individualFiles.map(f => f.links.self + '?download=1');
            const fullUrl = fullAudioFile ? fullAudioFile.links.self + '?download=1' : null;
            
            return {
                individualUrls,
                fullAudioUrl: fullUrl,
                fullAudioFilename: fullAudioFile ? fullAudioFile.key : null
            };
        }
        
        // „Ç∞„É≠„Çπ„ÅÆÂíåË®≥ËæûÊõ∏ÔºàSearchGloss„Éô„Éº„Çπ - Êã°ÂºµÁâàÔºâ
        const glossDictionary = {
            // Ê†ºÊ®ôË≠ò
            'nom': '‰∏ªÊ†º',
            'gen': 'Â±ûÊ†º',
            'acc': 'ÂØæÊ†º',
            'dat': '‰∏éÊ†º',
            'abl': 'Â•™Ê†º',
            'ins': 'ÂÖ∑Ê†º',
            'com': 'ÂÖ±Ê†º',
            'all': 'ÂêëÊ†º',
            'loc': 'ÊâÄÊ†º',
            'voc': 'ÂëºÊ†º',
            
            // Ê†º„ÅÆÂ§âÁ®Æ
            'nom1': '‰∏ªÊ†º1',
            'nom2': '‰∏ªÊ†º2',
            'gen1': 'Â±ûÊ†º1',
            'gen2': 'Â±ûÊ†º2',
            'acc1': 'ÂØæÊ†º1',
            'acc2': 'ÂØæÊ†º2',
            
            // ÊôÇÂà∂„Éª„Ç¢„Çπ„Éö„ÇØ„Éà
            'pst': 'ÈÅéÂéª',
            'npst': 'ÈùûÈÅéÂéª',
            'prs': 'ÁèæÂú®',
            'fut': 'Êú™Êù•',
            'dfut': 'ÈÅ†„ÅÑÊú™Êù•',
            'prog': 'ÈÄ≤Ë°å',
            'perf': 'ÂÆå‰∫Ü',
            'ipfv': 'Êú™ÂÆå‰∫Ü',
            'pfv': 'ÂÆå‰∫Ü',
            
            // „É¢„ÉÄ„É™„ÉÜ„Ç£
            'pot': 'ÂèØËÉΩ',
            'dub': 'Êé®Èáè',
            'pros': 'Êé®Ê∏¨',
            'seem': 'Êé®Ê∏¨',
            'chs': 'Êé®ÂÆö',
            'hs': '‰ºùËÅû',
            'asr': 'Êñ≠ÂÆö',
            'cnf': 'Á¢∫Ë™ç',
            'q': 'ÁñëÂïè',
            
            // Ê≥ï
            'imp': 'ÂëΩ‰ª§',
            'proh': 'Á¶ÅÊ≠¢',
            'opt': 'Â∏åÊ±Ç',
            'int': 'ÊÑèÂøó',
            'hort': 'ÂãßË™ò',
            'cond': 'Êù°‰ª∂',
            
            // ÊÖã
            'pass': 'ÂèóË∫´',
            'caus': '‰ΩøÂΩπ',
            'cvlz': '‰ΩøÂΩπÂåñ',
            'refl': 'ÂÜçÂ∏∞',
            'rfl': 'ÂÜçÂ∏∞',
            'recip': 'Áõ∏‰∫í',
            
            // Ë´áË©±Ê©üËÉΩ
            'top': '‰∏ªÈ°å',
            'foc': 'ÁÑ¶ÁÇπ',
            'otop': 'ÂØæÊØî‰∏ªÈ°å',
            'thm': '„ÉÜ„Éº„Éû',
            'quot': 'ÂºïÁî®',
            'dsc': 'Ë´áË©±Ê®ôË≠ò',
            'fil': '„Éï„Ç£„É©„Éº',
            
            // Êï∞„Éª‰∫∫Áß∞
            'sg': 'ÂçòÊï∞',
            'pl': 'Ë§áÊï∞',
            'du': 'ÂèåÊï∞',
            '1': '1‰∫∫Áß∞',
            '2': '2‰∫∫Áß∞',
            '3': '3‰∫∫Áß∞',
            'incl': 'ÂåÖÊã¨',
            'excl': 'Èô§Â§ñ',
            
            // Êï¨Ë™û
            'hon': 'Êï¨Ë™û',
            'hum': 'Ë¨ôË≠≤',
            'pol': '‰∏ÅÂØß',
            'adr': 'Êï¨Ë™û',
            
            // Êé•Á∂ö
            'seq': 'Á∂ôËµ∑',
            'sim': 'ÂêåÊôÇ',
            'ant': 'ÂÖàË°å',
            'csl': 'ÁêÜÁî±',
            'rsl': 'ÁµêÊûú',
            'cnc': 'ÈÄÜÊé•',
            'add': 'Ê∑ªÂä†',
            
            // Ê¥æÁîü
            'nlz': 'ÂêçË©ûÂåñ',
            'cnlz': 'ÂêçË©ûÂåñ',
            'vlz': 'ÂãïË©ûÂåñ',
            'adj': 'ÂΩ¢ÂÆπË©û',
            'adv': 'ÂâØË©û',
            
            // „Åù„ÅÆ‰ªñ
            'neg': 'Âê¶ÂÆö',
            'cop': '„Ç≥„Éî„É•„É©',
            'lv': 'ËªΩÂãïË©û',
            'aux': 'Âä©ÂãïË©û',
            'clf': 'È°ûÂà•Ë©û',
            'dim': 'ÊåáÂ∞èËæû',
            'aug': 'Â¢óÂ§ßËæû',
            'ben': 'ÂèóÁõä',
            'mal': 'Ë¢´ÂÆ≥',
            'inf': '‰∏≠Ê≠¢',
            'cvb': 'ÂâØÂãïË©û',
            'ptcp': 'ÂàÜË©û',
            'ger': 'ÂãïÂêçË©û',
            
            // ÊåáÁ§∫
            'prox': 'ËøëÁß∞',
            'med': '‰∏≠Áß∞',
            'dist': 'ÈÅ†Áß∞',
            'indf': '‰∏çÂÆö',
            
            // ÈôêÂÆö
            'aprx': 'Ëøë‰ºº',
            'lmt': 'ÈôêÁïå',
            'only': 'ÈôêÂÆö',
            'also': '„ÇÇ',
            'even': '„Åï„Åà',
            
            // „Åù„ÅÆ‰ªñ„ÅÆÊ©üËÉΩ
            'crcm': 'Áä∂Ê≥Å',
            'onm': '„Ç™„Éé„Éû„Éà„Éö',
            'intj': 'ÈñìÊäïË©û',
            'conn': 'Êé•Á∂öË©û',
            'prt': 'Âä©Ë©û',
            'post': 'ÂæåÁΩÆË©û',
            'prep': 'ÂâçÁΩÆË©û',
            
            // ÊñπË®ÄÁâπÊúâ„ÅÆ„Ç∞„É≠„ÇπÔºàÂøÖË¶Å„Å´Âøú„Åò„Å¶ËøΩÂä†Ôºâ
            'evid': 'Ë®ºÊã†ÊÄß',
            'mir': 'ÊÑèÂ§ñÊÄß',
            'exp': 'ÁµåÈ®ì',
            'hab': 'ÁøíÊÖ£',
            'iter': 'ÂèçÂæ©',
            'sem': 'Áû¨Èñì',
            'tel': 'ÂÆåÊàê',
            'atel': 'ÈùûÂÆåÊàê',
            'inch': 'Ëµ∑Âãï',
            'term': 'ÁµÇÁµê',
            'cont': 'Á∂ôÁ∂ö',
            'punc': 'Áû¨ÊôÇ',
            'dur': 'ÊåÅÁ∂ö',
            'freq': 'È†ªÂ∫¶',
            'distr': 'ÈÖçÂàÜ',
            'coll': 'ÈõÜÂêà',
            'assoc': 'Èöè‰º¥',
            'priv': 'Ê¨†Â¶Ç',
            'poss': 'ÊâÄÊúâ',
            'part': 'ÈÉ®ÂàÜ',
            'temp': 'ÊôÇ',
            'mann': 'ÊßòÊÖã',
            'purp': 'ÁõÆÁöÑ',
            'inst': 'ÈÅìÂÖ∑',
            'conc': 'Ë≠≤Ê≠©',
            'comp': 'ÊØîËºÉ',
            'super': 'ÊúÄ‰∏äÁ¥ö',
            'equ': 'ÂêåÁ≠â',
            'sim': 'È°û‰ºº',
            'diff': 'Áõ∏ÈÅï'
        };
        
        
        // DOM„ÅÆË™≠„ÅøËæº„ÅøÂÆå‰∫ÜÂæå„Å´ÂàùÊúüÂåñ
        window.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            
            // Âüã„ÇÅËæº„Åø„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØËá™ÂãïÁöÑ„Å´Âá¶ÁêÜ
            if (window.embeddedData) {
                processFiles();
            }
        });
        
        // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆö
        function setupEventListeners() {
            // „Éï„Ç°„Ç§„É´ÈÅ∏ÊäûÊôÇ„ÅÆÂá¶ÁêÜ
            const dataFile = document.getElementById('dataFile');
            if (dataFile) dataFile.addEventListener('change', checkFiles);
            
            // Âá¶ÁêÜ„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ
            const processButton = document.getElementById('processButton');
            if (processButton) processButton.addEventListener('click', processFiles);
            
            // ÂÖ®‰ΩìÈü≥Â£∞ÂÜçÁîü„Éú„Çø„É≥
            const playAllBtn = document.getElementById('playAllBtn');
            if (playAllBtn) playAllBtn.addEventListener('click', playFullAudio);
            
            // „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„Éú„Çø„É≥„ÅÆ„ÇØ„É™„ÉÉ„ÇØ
            const downloadBtn = document.getElementById('downloadBtn');
            if (downloadBtn) downloadBtn.addEventListener('click', downloadHTML);
            
            // ZenodoÂèñÂæó„Éú„Çø„É≥
            const zenodoFetchBtn = document.getElementById('zenodoFetchBtn');
            if (zenodoFetchBtn) {
                zenodoFetchBtn.addEventListener('click', async function() {
                    const zenodoInput = document.getElementById('zenodoUrl');
                    const zenodoStatus = document.getElementById('zenodoStatus');
                    const fullAudioUrlInput = document.getElementById('fullAudioUrl');
                    const recordUrl = zenodoInput.value.trim();
                    
                    if (!recordUrl) {
                        zenodoStatus.textContent = '‚ùå Zenodo„É¨„Ç≥„Éº„ÉâURL„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                        zenodoStatus.className = 'zenodo-status error';
                        return;
                    }
                    
                    // „Éú„Çø„É≥„ÇíÁÑ°ÂäπÂåñ
                    zenodoFetchBtn.disabled = true;
                    zenodoFetchBtn.textContent = '‚è≥ ÂèñÂæó‰∏≠...';
                    zenodoStatus.textContent = 'Zenodo API„Å´Êé•Á∂ö‰∏≠...';
                    zenodoStatus.className = 'zenodo-status';
                    
                    try {
                        const result = await fetchZenodoFiles(recordUrl);
                        
                        // ÂÄãÂà•Èü≥Â£∞URLs„Å´Ë®≠ÂÆö
                        audioUrls = result.individualUrls;
                        
                        // ÂÖ®‰ΩìÈü≥Â£∞URL„ÇíË®≠ÂÆö
                        if (result.fullAudioUrl && fullAudioUrlInput) {
                            fullAudioUrl = result.fullAudioUrl;
                            fullAudioUrlInput.value = result.fullAudioUrl;
                        }
                        
                        // ÊâãÂãïÂÖ•Âäõ„Ç®„É™„Ç¢„Å´„ÇÇURL„É™„Çπ„Éà„ÇíË°®Á§∫
                        const manualUrlList = document.getElementById('manualUrlList');
                        if (manualUrlList) {
                            manualUrlList.value = result.individualUrls.join('\n');
                        }
                        const manualUrlCount = document.getElementById('manualUrlCount');
                        if (manualUrlCount) {
                            manualUrlCount.textContent = `‚úÖ ${result.individualUrls.length}‰ª∂„ÅÆURL`;
                            manualUrlCount.className = 'manual-url-count has-urls';
                        }
                        
                        // „Çπ„ÉÜ„Éº„Çø„Çπ„É°„ÉÉ„Çª„Éº„Ç∏‰ΩúÊàê
                        let statusMsg = `‚úÖ ${result.individualUrls.length}‰ª∂„ÅÆÂÄãÂà•Èü≥Â£∞`;
                        if (result.fullAudioUrl) {
                            statusMsg += ` + ÂÖ®‰ΩìÈü≥Â£∞Ôºà${result.fullAudioFilename}Ôºâ`;
                        }
                        statusMsg += '„ÇíÂèñÂæó„Åó„Åæ„Åó„Åü';
                        
                        zenodoStatus.textContent = statusMsg;
                        zenodoStatus.className = 'zenodo-status success';
                        
                        // Âá¶ÁêÜ„Éú„Çø„É≥„ÅÆÁä∂ÊÖã„ÇíÊõ¥Êñ∞
                        checkFiles();
                        
                    } catch (err) {
                        zenodoStatus.textContent = '‚ùå ' + err.message;
                        zenodoStatus.className = 'zenodo-status error';
                    } finally {
                        zenodoFetchBtn.disabled = false;
                        zenodoFetchBtn.textContent = 'üì• ÂèñÂæó';
                    }
                });
            }
            
            // ÊâãÂãïURLÂÖ•Âäõ„Ç®„É™„Ç¢
            const manualUrlList = document.getElementById('manualUrlList');
            if (manualUrlList) {
                manualUrlList.addEventListener('input', function(e) {
                    const text = e.target.value;
                    const urls = text.trim().split('\n')
                        .map(u => u.trim())
                        .filter(u => u && u.startsWith('http'));
                    
                    audioUrls = urls;
                    
                    const countEl = document.getElementById('manualUrlCount');
                    if (countEl) {
                        if (urls.length > 0) {
                            countEl.textContent = `‚úÖ ${urls.length}‰ª∂„ÅÆURL`;
                            countEl.className = 'manual-url-count has-urls';
                        } else {
                            countEl.textContent = '';
                            countEl.className = 'manual-url-count';
                        }
                    }
                    
                    checkFiles();
                });
            }
            
            // „Ç∞„É≠„Çπ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
            document.addEventListener('click', async function(e) {
                if (e.target.classList.contains('gloss-clickable')) {
                    e.stopPropagation();
                    const gloss = e.target.dataset.gloss;
                    await showGlossTooltip(gloss, e.target);
                } else if (!e.target.closest('.gloss-tooltip')) {
                    hideGlossTooltip();
                }
            });
            
            // Èü≥Â£∞ÁµÇ‰∫ÜÊôÇ„ÅÆÂá¶ÁêÜ
            const audio = document.getElementById('audio');
            if (audio) {
                audio.addEventListener('ended', function() {
                    updatePlayingState(null);
                });
                
                audio.addEventListener('timeupdate', updateProgress);
            }
        }
        
        // „Éï„Ç°„Ç§„É´„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
        function checkFiles() {
            const dataFile = document.getElementById('dataFile').files[0];
            const processButton = document.getElementById('processButton');
            
            // „Éá„Éº„Çø„Éï„Ç°„Ç§„É´„Åå„ÅÇ„Çä„ÄÅ„Åã„Å§Zenodo„Åã„ÇâÂèñÂæóÊ∏à„Åø
            processButton.disabled = !(dataFile && audioUrls.length > 0);
        }
        
        // „Éï„Ç°„Ç§„É´„ÇíÂá¶ÁêÜ
        
        // „Éï„Ç°„Ç§„É´„ÇíÂá¶ÁêÜÔºàÂüã„ÇÅËæº„Åø„Éá„Éº„ÇøÁâàÔºâ
        async function processFiles() {
            // Âüã„ÇÅËæº„Åæ„Çå„Åü„Éá„Éº„Çø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            if (window.embeddedData) {
                examples = window.embeddedData.examples;
                audioUrls = window.embeddedData.audioUrls;
                fullAudioUrl = window.embeddedData.fullAudioUrl;
                
                console.log('Âüã„ÇÅËæº„Åæ„Çå„Åü„Éá„Éº„Çø„Çí‰ΩøÁî®„Åó„Åæ„Åô');
                console.log(`‰æãÊñáÊï∞: ${examples.length}`);
                console.log(`Èü≥Â£∞URLÊï∞: ${audioUrls.length}`);
                
                // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
                displayContent();
                
                // „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
                const uploadSection = document.getElementById('uploadSection');
                if (uploadSection) {
                    uploadSection.style.display = 'none';
                }
                document.getElementById('contentSection').style.display = 'block';
                
                return;
            }
            
            // ÂÖÉ„ÅÆprocessFilesÈñ¢Êï∞„ÅÆ„Ç≥„Éº„Éâ
            
            const dataFile = document.getElementById('dataFile').files[0];
            const titleInput = document.getElementById('titleInput').value.trim();
            const subtitleInput = document.getElementById('subtitleInput').value.trim();
            
            try {
                showStatus('„Éï„Ç°„Ç§„É´„ÇíÂá¶ÁêÜ‰∏≠...', 'info');
                
                // „Çø„Ç§„Éà„É´„Å®„Çµ„Éñ„Çø„Ç§„Éà„É´„ÇíË®≠ÂÆö
                if (titleInput) {
                    document.getElementById('pageTitle').textContent = titleInput;
                }
                if (subtitleInput) {
                    document.getElementById('pageSubtitle').textContent = subtitleInput;
                }
                
                // ÂÖ®‰ΩìÈü≥Â£∞URL„ÇíÁ¢∫Ë™çÔºàÊâãÂãï„ÅßÂ§âÊõ¥„Åï„Çå„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„Åü„ÇÅÔºâ
                const fullAudioUrlInput = document.getElementById('fullAudioUrl');
                const fullAudioInputValue = fullAudioUrlInput ? fullAudioUrlInput.value.trim() : '';
                if (fullAudioInputValue) {
                    fullAudioUrl = fullAudioInputValue;
                }
                
                console.log(`Èü≥Â£∞URL„Çí${audioUrls.length}ÂÄãË™≠„ÅøËæº„Åø„Åæ„Åó„Åü`);
                if (fullAudioUrl) {
                    console.log('ÂÖ®‰ΩìÈü≥Â£∞URL:', fullAudioUrl);
                }
                
                // „Éá„Éº„Çø„Éï„Ç°„Ç§„É´„ÅÆÂá¶ÁêÜÔºà„ÉÜ„Ç≠„Çπ„Éà„Åæ„Åü„ÅØPDFÔºâ
                if (dataFile.name.endsWith('.txt')) {
                    await processTextFile(dataFile);
                } else if (dataFile.name.endsWith('.pdf')) {
                    await processPDF(dataFile);
                }
                
                // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
                displayContent();
                
                showStatus('Âá¶ÁêÜ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„ÅüÔºÅ', 'success');
                
                // 2ÁßíÂæå„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
                setTimeout(() => {
                    document.getElementById('uploadSection').style.display = 'none';
                    document.getElementById('contentSection').style.display = 'block';
                }, 2000);
                
            } catch (error) {
                showStatus('„Ç®„É©„Éº: ' + error.message, 'error');
                console.error(error);
            }
        }
        
        // „ÉÜ„Ç≠„Çπ„Éà„Éï„Ç°„Ç§„É´„ÇíÂá¶ÁêÜ
        async function processTextFile(file) {
            const text = await file.text();
            const lines = text.split('\n');
            
            examples = [];
            let lineIndex = 0;
            
            while (lineIndex < lines.length) {
                const line = lines[lineIndex].trim();
                
                // ‰æãÊñáÁï™Âè∑„ÅÆÊ§úÂá∫
                const numberMatch = line.match(/^\((\d+)\)$/);
                if (numberMatch) {
                    const id = parseInt(numberMatch[1]);
                    const currentExample = {
                        id: id,
                        original: '',
                        gloss: '',
                        japanese: ''
                    };
                    
                    // Ê¨°„ÅÆË°å„Åã„ÇâÂÜÖÂÆπ„ÇíÂèéÈõÜ
                    const contentLines = [];
                    lineIndex++;
                    
                    // Ê¨°„ÅÆ‰æãÊñáÁï™Âè∑„ÅåÊù•„Çã„Åæ„Åß„ÄÅ„Åæ„Åü„ÅØÁ©∫Ë°å„ÅåÈÄ£Á∂ö„Åô„Çã„Åæ„ÅßË°å„ÇíÂèéÈõÜ
                    while (lineIndex < lines.length) {
                        const nextLine = lines[lineIndex].trim();
                        
                        // Ê¨°„ÅÆ‰æãÊñáÁï™Âè∑„Å´Âà∞ÈÅî„Åó„Åü„ÇâÁµÇ‰∫Ü
                        if (nextLine.match(/^\((\d+)\)$/)) {
                            break;
                        }
                        
                        // Á©∫Ë°å„ÅØ„Çπ„Ç≠„ÉÉ„Éó„Åô„Çã„Åå„ÄÅÂèéÈõÜ„ÅØÁ∂ö„Åë„Çã
                        if (nextLine) {
                            contentLines.push(nextLine);
                        }
                        
                        lineIndex++;
                    }
                    
                    // ÂèéÈõÜ„Åó„ÅüË°åÊï∞„Å´Âü∫„Å•„ÅÑ„Å¶ÂΩ¢Âºè„ÇíÂà§ÂÆö
                    if (contentLines.length === 2) {
                        // 2Ë°åÂΩ¢Âºè: ‰æãÊñá„ÄÅÊó•Êú¨Ë™ûË®≥
                        currentExample.original = contentLines[0];
                        currentExample.japanese = contentLines[1];
                        currentExample.gloss = ''; // „Ç∞„É≠„Çπ„Å™„Åó
                    } else if (contentLines.length === 3) {
                        // 3Ë°åÂΩ¢Âºè: ÂéüÊñá„ÄÅ„Ç∞„É≠„Çπ„ÄÅÊó•Êú¨Ë™ûË®≥
                        currentExample.original = contentLines[0];
                        currentExample.gloss = contentLines[1];
                        currentExample.japanese = contentLines[2];
                    } else if (contentLines.length >= 4) {
                        // 4Ë°åÂΩ¢Âºè: „Çπ„Éö„Éº„Çπ„ÅÇ„Çä‰æãÊñá„ÄÅÂΩ¢ÊÖãÁ¥†Â¢ÉÁïåÂÖ•„Çä‰æãÊñá„ÄÅ„Ç∞„É≠„Çπ„ÄÅÊó•Êú¨Ë™ûË®≥
                        currentExample.originalSpaced = contentLines[0]; // „Çπ„Éö„Éº„Çπ„ÅÇ„Çä‰æãÊñá
                        currentExample.original = contentLines[1]; // ÂΩ¢ÊÖãÁ¥†Â¢ÉÁïåÂÖ•„Çä‰æãÊñá
                        currentExample.gloss = contentLines[2];
                        currentExample.japanese = contentLines[3];
                        
                        // Êó•Êú¨Ë™ûË®≥„ÅåË§áÊï∞Ë°å„Å´„Çè„Åü„ÇãÂ†¥Âêà„ÅØÁµêÂêà
                        for (let i = 4; i < contentLines.length; i++) {
                            if (contentLines[i].match(/[\u3040-\u309f\u30a0-\u30ff\u4e00-\u9faf]/)) {
                                currentExample.japanese += contentLines[i];
                            }
                        }
                    }
                    
                    // ‰æãÊñá„ÇíËøΩÂä†
                    if (currentExample.original) {
                        examples.push(currentExample);
                    }
                } else {
                    lineIndex++;
                }
            }
            
            console.log(`„ÉÜ„Ç≠„Çπ„Éà„Éï„Ç°„Ç§„É´„Åã„Çâ${examples.length}ÂÄã„ÅÆ‰æãÊñá„ÇíÊäΩÂá∫„Åó„Åæ„Åó„Åü`);
            
            // „Éá„Éê„ÉÉ„Ç∞Áî®ÔºöÊúÄÂàù„ÅÆ3„Å§„ÅÆ‰æãÊñá„ÇíË°®Á§∫
            examples.slice(0, 3).forEach(ex => {
                console.log(`‰æãÊñá${ex.id}:`);
                console.log(`  ÂéüÊñá: ${ex.original}`);
                console.log(`  „Ç∞„É≠„Çπ: ${ex.gloss}`);
                console.log(`  Êó•Êú¨Ë™û: ${ex.japanese}`);
            });
        }
        
        // PDF„ÇíÂá¶ÁêÜ
        async function processPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            
            examples = [];
            let allTextItems = [];
            
            // ÂÖ®„Éö„Éº„Ç∏„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„Ç¢„Ç§„ÉÜ„É†„ÇíÂèéÈõÜ
            for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
                const page = await pdf.getPage(pageNum);
                const textContent = await page.getTextContent();
                
                textContent.items.forEach(item => {
                    if (item.str.trim()) {
                        allTextItems.push({
                            text: item.str,
                            x: item.transform[4],
                            y: item.transform[5],
                            page: pageNum
                        });
                    }
                });
            }
            
            // YÂ∫ßÊ®ô„Åß„ÇΩ„Éº„ÉàÔºà‰∏ä„Åã„Çâ‰∏ã„Å∏Ôºâ
            allTextItems.sort((a, b) => {
                if (a.page !== b.page) return a.page - b.page;
                return b.y - a.y;
            });
            
            // Âêå„ÅòË°å„ÅÆ„Ç¢„Ç§„ÉÜ„É†„Çí„Ç∞„É´„Éº„ÉóÂåñ
            let lines = [];
            let currentLine = [];
            let lastY = null;
            
            allTextItems.forEach(item => {
                if (lastY === null || Math.abs(item.y - lastY) < 5) {
                    currentLine.push(item);
                } else {
                    if (currentLine.length > 0) {
                        // XÂ∫ßÊ®ô„Åß„ÇΩ„Éº„ÉàÔºàÂ∑¶„Åã„ÇâÂè≥„Å∏Ôºâ
                        currentLine.sort((a, b) => a.x - b.x);
                        const lineText = currentLine.map(i => i.text).join(' ');
                        lines.push(lineText);
                    }
                    currentLine = [item];
                }
                lastY = item.y;
            });
            
            // ÊúÄÂæå„ÅÆË°å„ÇíËøΩÂä†
            if (currentLine.length > 0) {
                currentLine.sort((a, b) => a.x - b.x);
                const lineText = currentLine.map(i => i.text).join(' ');
                lines.push(lineText);
            }
            
            // ‰æãÊñá„ÇíËß£Êûê
            let currentExample = null;
            let expectingGloss = false;
            let expectingJapanese = false;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // ‰æãÊñáÁï™Âè∑„ÅÆÊ§úÂá∫
                const numberMatch = line.match(/^[\(Ôºà](\d+)[\)Ôºâ]\s*(.+)$/);
                if (numberMatch) {
                    // Ââç„ÅÆ‰æãÊñá„Çí‰øùÂ≠ò
                    if (currentExample) {
                        examples.push(currentExample);
                    }
                    
                    currentExample = {
                        id: parseInt(numberMatch[1]),
                        original: numberMatch[2].trim(),
                        gloss: '',
                        japanese: ''
                    };
                    expectingGloss = true;
                    expectingJapanese = false;
                } else if (currentExample && expectingGloss) {
                    // „Ç∞„É≠„ÇπË°åÔºàÂ∞èÊñáÂ≠ó„ÄÅ„Éî„É™„Ç™„Éâ„ÄÅÂ§ßÊñáÂ≠ó„ÇíÂê´„ÇÄÔºâ
                    if (line.match(/^[a-zA-Z0-9\.\-\s]+$/)) {
                        currentExample.gloss = line;
                        expectingGloss = false;
                        expectingJapanese = true;
                    }
                } else if (currentExample && expectingJapanese) {
                    // Êó•Êú¨Ë™ûË®≥
                    if (line.match(/[\u3040-\u309f\u30a0-\u30ff\u4e00-\u9faf]/)) {
                        currentExample.japanese = line;
                        expectingJapanese = false;
                    }
                }
            }
            
            // ÊúÄÂæå„ÅÆ‰æãÊñá„Çí‰øùÂ≠ò
            if (currentExample) {
                examples.push(currentExample);
            }
            
            console.log(`PDF„Åã„Çâ${examples.length}ÂÄã„ÅÆ‰æãÊñá„ÇíÊäΩÂá∫„Åó„Åæ„Åó„Åü`);
            
            // „Éá„Éê„ÉÉ„Ç∞Áî®ÔºöÊúÄÂàù„ÅÆ3„Å§„ÅÆ‰æãÊñá„ÇíË°®Á§∫
            examples.slice(0, 3).forEach(ex => {
                console.log(`‰æãÊñá${ex.id}:`);
                console.log(`  ÂéüÊñá: ${ex.original}`);
                console.log(`  „Ç∞„É≠„Çπ: ${ex.gloss}`);
                console.log(`  Êó•Êú¨Ë™û: ${ex.japanese}`);
            });
        }
        
        // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
        function displayContent() {
            const exampleList = document.getElementById('exampleList');
            const exampleCount = document.getElementById('exampleCount');
            const playAllBtn = document.getElementById('playAllBtn');
            
            // ‰æãÊñáÊï∞„ÇíË°®Á§∫
            exampleCount.textContent = examples.length;
            
            // ‰æãÊñá„É™„Çπ„Éà„Çí„ÇØ„É™„Ç¢
            exampleList.innerHTML = '';
            
            // ÂêÑ‰æãÊñá„ÇíË°®Á§∫
            examples.forEach((example, index) => {
                const exampleItem = createExampleElement(example, index);
                exampleList.appendChild(exampleItem);
            });
            
            // ÂÖ®‰ΩìÈü≥Â£∞„Éú„Çø„É≥„ÅÆË°®Á§∫/ÈùûË°®Á§∫
            if (!fullAudioUrl) {
                playAllBtn.style.display = 'none';
            } else {
                playAllBtn.style.display = 'flex';
            }
        }
        
        // ‰æãÊñáË¶ÅÁ¥†„Çí‰ΩúÊàê
        function createExampleElement(example, index) {
            const div = document.createElement('div');
            div.className = 'example-item';
            div.dataset.id = example.id;
            
            // „Ç§„É≥„Çø„Éº„É™„Éã„Ç¢ÂΩ¢Âºè„ÅßË°®Á§∫
            let interlinearHTML;
            if (example.originalSpaced) {
                // 4Ë°åÂΩ¢Âºè„ÅÆÂ†¥Âêà
                interlinearHTML = createInterlinearHTML4Line(example.originalSpaced, example.original, example.gloss);
            } else {
                // 2Ë°å„Åæ„Åü„ÅØ3Ë°åÂΩ¢Âºè„ÅÆÂ†¥Âêà
                interlinearHTML = createInterlinearHTML(example.original, example.gloss);
            }
            
            div.innerHTML = `
                <div class="example-number">(${example.id})</div>
                <div class="example-text">
                    <div class="interlinear-container">
                        ${interlinearHTML}
                    </div>
                    <div class="translation-text">${example.japanese}</div>
                </div>
                <div class="play-icon">‚ñ∂</div>
            `;
            
            // „ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà„ÇíËøΩÂä†
            div.addEventListener('click', function(e) {
                if (!e.target.classList.contains('gloss-clickable')) {
                    playExample(example.id);
                }
            });
            
            return div;
        }
        
        // „Ç§„É≥„Çø„Éº„É™„Éã„Ç¢ÂΩ¢Âºè„ÅÆHTML„ÇíÁîüÊàê
        function createInterlinearHTML(originalText, glossText) {
            const originalWords = originalText.split(/\s+/);
            const glossWords = glossText.split(/\s+/);
            
            let html = '<div class="interlinear-row">';
            
            for (let i = 0; i < Math.max(originalWords.length, glossWords.length); i++) {
                const originalWord = originalWords[i] || '';
                const glossWord = glossWords[i] || '';
                
                // „Ç∞„É≠„Çπ„Çí„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Å´„Åô„Çã
                const clickableGloss = makeGlossClickable(glossWord);
                
                html += `
                    <div class="word-group">
                        <div class="original-word">${originalWord}</div>
                        <div class="gloss-word">${clickableGloss}</div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }
        
        // 4Ë°åÂΩ¢Âºè„ÅÆ„Ç§„É≥„Çø„Éº„É™„Éã„Ç¢HTML„ÇíÁîüÊàê
        function createInterlinearHTML4Line(spacedText, boundaryText, glossText) {
            const spacedWords = spacedText.split(/\s+/);
            const boundaryWords = boundaryText.split(/\s+/);
            const glossWords = glossText.split(/\s+/);
            
            let html = '<div class="interlinear-row">';
            
            for (let i = 0; i < Math.max(spacedWords.length, boundaryWords.length, glossWords.length); i++) {
                const spacedWord = spacedWords[i] || '';
                const boundaryWord = boundaryWords[i] || '';
                const glossWord = glossWords[i] || '';
                
                // „Ç∞„É≠„Çπ„Çí„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Å´„Åô„Çã
                const clickableGloss = makeGlossClickable(glossWord);
                
                html += `
                    <div class="word-group">
                        <div class="original-word">${spacedWord}</div>
                        <div class="original-word" style="font-size: 16px; color: #444; font-weight: normal;">${boundaryWord}</div>
                        <div class="gloss-word">${clickableGloss}</div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }
        
        // „Ç∞„É≠„Çπ„Çí„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Å´„Åô„Çã
        function makeGlossClickable(glossText) {
            // „Ç∞„É≠„Çπ„Éë„Çø„Éº„É≥„ÅÆÊ§úÂá∫ÔºàËã±Â≠ó„Å®„Éî„É™„Ç™„Éâ„ÅÆÁµÑ„ÅøÂêà„Çè„ÅõÔºâ
            const glossPattern = /[a-zA-Z]+(\.[a-zA-Z0-9]+)*/g;
            
            return glossText.replace(glossPattern, (match) => {
                // Êó•Êú¨Ë™û„ÅåÂê´„Åæ„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÈô§Â§ñ
                if (match.match(/[„ÅÅ-„Çì„Ç°-„É∂„Éº‰∏Ä-ÈæØ]/)) {
                    return match;
                }
                return `<span class="gloss-clickable" data-gloss="${match}">${match}</span>`;
            });
        }
        
        // Èü≥Â£∞„ÇíÂÜçÁîü
        async function playExample(id) {
            const audio = document.getElementById('audio');
            const exampleItem = document.querySelector(`[data-id="${id}"]`);
            
            if (!audio || !exampleItem) {
                console.error('Audio element or example item not found');
                return;
            }
            
            // Êó¢„Å´ÂÜçÁîü‰∏≠„ÅÆÂ†¥Âêà„ÅØÂÅúÊ≠¢
            if (currentlyPlaying === id && !audio.paused) {
                audio.pause();
                updatePlayingState(null);
                return;
            }
            
            try {
                // ÂØæÂøú„Åô„ÇãÈü≥Â£∞URL„ÇíÂèñÂæó
                const audioUrl = audioUrls[id - 1];
                if (!audioUrl) {
                    throw new Error(`Èü≥Â£∞„Éï„Ç°„Ç§„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì (‰æãÊñá ${id})`);
                }
                
                console.log(`Playing audio ${id}: ${audioUrl}`);
                
                // Èü≥Â£∞„ÇíÂÅúÊ≠¢„Åó„Å¶„É™„Çª„ÉÉ„Éà
                audio.pause();
                audio.currentTime = 0;
                
                // Áõ¥Êé•URL„Çí‰ΩøÁî®ÔºàCORS„Éó„É≠„Ç≠„Ç∑„ÅØÊúÄÂæå„ÅÆÊâãÊÆµ„Å®„Åó„Å¶Ôºâ
                let finalUrl = audioUrl;
                
                // Êñ∞„Åó„ÅÑÈü≥Â£∞„Çí„É≠„Éº„Éâ
                audio.src = finalUrl;
                
                // „É≠„Éº„ÉâÂÆå‰∫Ü„ÇíÂæÖ„Å£„Å¶„Åã„ÇâÂÜçÁîü
                const playPromise = audio.play();
                
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            console.log('Audio playback started successfully');
                            updatePlayingState(id);
                        })
                        .catch(async (error) => {
                            console.error('Initial playback failed:', error);
                            
                            // CORS„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÅØ„Éó„É≠„Ç≠„Ç∑„ÇíË©¶„Åô
                            if (error.name === 'NotAllowedError' || error.name === 'NotSupportedError') {
                                console.log('Trying with CORS proxy...');
                                
                                // CORS„Éó„É≠„Ç≠„Ç∑„Çí‰ΩøÁî®
                                finalUrl = 'https://corsproxy.io/?' + encodeURIComponent(audioUrl);
                                audio.src = finalUrl;
                                
                                try {
                                    await audio.play();
                                    updatePlayingState(id);
                                    console.log('Playback successful with CORS proxy');
                                } catch (proxyError) {
                                    console.error('CORS proxy also failed:', proxyError);
                                    
                                    // Âà•„ÅÆCORS„Éó„É≠„Ç≠„Ç∑„ÇíË©¶„Åô
                                    finalUrl = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(audioUrl);
                                    audio.src = finalUrl;
                                    
                                    try {
                                        await audio.play();
                                        updatePlayingState(id);
                                        console.log('Playback successful with alternative proxy');
                                    } catch (altProxyError) {
                                        console.error('All playback attempts failed:', altProxyError);
                                        showStatus(`Èü≥Â£∞„ÅÆÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü (‰æãÊñá ${id})„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„ÇÑ„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`, 'error');
                                    }
                                }
                            }
                        });
                }
                
            } catch (error) {
                console.error('Èü≥Â£∞ÂÜçÁîü„Ç®„É©„Éº:', error);
                showStatus('Èü≥Â£∞„ÅÆÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            }
        }
        
        // ÂÖ®‰ΩìÈü≥Â£∞„ÇíÂÜçÁîü
        async function playFullAudio() {
            const audio = document.getElementById('audio');
            const playAllBtn = document.getElementById('playAllBtn');
            
            if (!fullAudioUrl) {
                showStatus('ÂÖ®‰ΩìÈü≥Â£∞„ÅÆURL„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì', 'error');
                return;
            }
            
            // Êó¢„Å´ÂÜçÁîü‰∏≠„ÅÆÂ†¥Âêà„ÅØÂÅúÊ≠¢
            if (currentlyPlaying === 'full' && !audio.paused) {
                audio.pause();
                updatePlayingState(null);
                return;
            }
            
            try {
                // Èü≥Â£∞„ÇíÂÅúÊ≠¢„Åó„Å¶„É™„Çª„ÉÉ„Éà
                audio.pause();
                audio.currentTime = 0;
                
                // Áõ¥Êé•URL„Çí‰ΩøÁî®
                let finalUrl = fullAudioUrl;
                
                console.log('Playing full audio:', finalUrl);
                
                audio.src = finalUrl;
                
                // ÂÜçÁîü„ÇíË©¶„Åø„Çã
                const playPromise = audio.play();
                
                if (playPromise !== undefined) {
                    playPromise
                        .then(() => {
                            console.log('Full audio playback started successfully');
                            playAllBtn.classList.add('playing');
                            playAllBtn.querySelector('.button-text').textContent = 'ÂÅúÊ≠¢';
                            playAllBtn.querySelector('.button-icon').textContent = '‚è∏';
                            updatePlayingState('full');
                        })
                        .catch(async (error) => {
                            console.error('Full audio playback failed:', error);
                            
                            // CORS„Ç®„É©„Éº„ÅÆÂ†¥Âêà„ÅØ„Éó„É≠„Ç≠„Ç∑„ÇíË©¶„Åô
                            if (error.name === 'NotAllowedError' || error.name === 'NotSupportedError') {
                                console.log('Trying with CORS proxy for full audio...');
                                
                                finalUrl = 'https://corsproxy.io/?' + encodeURIComponent(fullAudioUrl);
                                audio.src = finalUrl;
                                
                                try {
                                    await audio.play();
                                    playAllBtn.classList.add('playing');
                                    playAllBtn.querySelector('.button-text').textContent = 'ÂÅúÊ≠¢';
                                    playAllBtn.querySelector('.button-icon').textContent = '‚è∏';
                                    updatePlayingState('full');
                                } catch (proxyError) {
                                    console.error('CORS proxy also failed:', proxyError);
                                    showStatus('ÂÖ®‰ΩìÈü≥Â£∞„ÅÆÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
                                }
                            }
                        });
                }
                
            } catch (error) {
                console.error('ÂÖ®‰ΩìÈü≥Â£∞„ÅÆÂÜçÁîü„Ç®„É©„Éº:', error);
                showStatus('ÂÖ®‰ΩìÈü≥Â£∞„ÅÆÂÜçÁîü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message, 'error');
            }
        }
        
        // ÂÜçÁîüÁä∂ÊÖã„ÇíÊõ¥Êñ∞
        function updatePlayingState(id) {
            const audioPlayer = document.getElementById('audioPlayer');
            const currentExample = document.getElementById('currentExample');
            const playAllBtn = document.getElementById('playAllBtn');
            
            // „Åô„Åπ„Å¶„ÅÆ‰æãÊñá„ÅÆ„Éè„Ç§„É©„Ç§„Éà„ÇíËß£Èô§
            document.querySelectorAll('.example-item').forEach(item => {
                item.classList.remove('playing');
                item.querySelector('.play-icon').textContent = '‚ñ∂';
            });
            
            // ÂÖ®‰ΩìÈü≥Â£∞„Éú„Çø„É≥„ÅÆ„É™„Çª„ÉÉ„Éà
            playAllBtn.classList.remove('playing');
            playAllBtn.querySelector('.button-text').textContent = 'ÂÖ®‰ΩìÈü≥Â£∞„ÇíÂÜçÁîü';
            playAllBtn.querySelector('.button-icon').textContent = '‚ñ∂';
            
            if (id === 'full') {
                // ÂÖ®‰ΩìÈü≥Â£∞ÂÜçÁîü‰∏≠
                currentExample.textContent = 'ÂÖ®‰ΩìÈü≥Â£∞';
                audioPlayer.classList.add('active');
                playAllBtn.classList.add('playing');
                playAllBtn.querySelector('.button-text').textContent = 'ÂÅúÊ≠¢';
                playAllBtn.querySelector('.button-icon').textContent = '‚è∏';
            } else if (id !== null) {
                // ÂÄãÂà•‰æãÊñáÂÜçÁîü‰∏≠
                const playingItem = document.querySelector(`[data-id="${id}"]`);
                if (playingItem) {
                    playingItem.classList.add('playing');
                    playingItem.querySelector('.play-icon').textContent = '‚è∏';
                }
                currentExample.textContent = `‰æãÊñá (${id})`;
                audioPlayer.classList.add('active');
            } else {
                // ÂÅúÊ≠¢
                audioPlayer.classList.remove('active');
                document.getElementById('progressBar').style.width = '0%';
            }
            
            currentlyPlaying = id;
        }
        
        // ÈÄ≤Ë°åÁä∂Ê≥Å„ÇíÊõ¥Êñ∞
        function updateProgress() {
            const audio = document.getElementById('audio');
            const progressBar = document.getElementById('progressBar');
            
            if (audio.duration) {
                const progress = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = progress + '%';
            }
        }
        
        // „Ç∞„É≠„Çπ„ÅÆÂêπ„ÅçÂá∫„Åó„ÇíË°®Á§∫
        async function showGlossTooltip(gloss, element) {
            const tooltip = document.getElementById('glossTooltip');
            const glossTitle = document.getElementById('glossTitle');
            const glossDescription = document.getElementById('glossDescription');
            
            // „Ç∞„É≠„Çπ„ÅÆÁøªË®≥„ÇíÂèñÂæó
            const translation = await getGlossTranslation(gloss);
            
            glossTitle.textContent = gloss.toUpperCase();
            glossDescription.textContent = translation;
            
            // ‰ΩçÁΩÆ„ÇíË®àÁÆó
            const rect = element.getBoundingClientRect();
            const tooltipWidth = 300;
            let left = rect.left + (rect.width / 2) - (tooltipWidth / 2);
            const top = rect.top - 80;
            
            // ÁîªÈù¢„Åã„Çâ„ÅØ„ÅøÂá∫„Å™„ÅÑ„Çà„ÅÜ„Å´Ë™øÊï¥
            if (left < 10) left = 10;
            if (left + tooltipWidth > window.innerWidth - 10) {
                left = window.innerWidth - tooltipWidth - 10;
            }
            
            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.classList.add('show');
        }
        
        // „Ç∞„É≠„Çπ„ÅÆÂêπ„ÅçÂá∫„Åó„ÇíÈùûË°®Á§∫
        function hideGlossTooltip() {
            const tooltip = document.getElementById('glossTooltip');
            if (tooltip) {
                tooltip.classList.remove('show');
            }
        }
        
        // Ë§áÂêà„Ç∞„É≠„Çπ„ÇíËß£Êûê„Åó„Å¶Ë™¨Êòé„ÇíÁîüÊàê
        async function getGlossTranslation(gloss) {
            // ÂÜÖËîµËæûÊõ∏„Åã„ÇâÊ§úÁ¥¢
            const parts = gloss.toLowerCase().split('.');
            const translations = [];
            let allFound = true;
            
            for (const part of parts) {
                if (glossDictionary[part]) {
                    translations.push(glossDictionary[part]);
                } else if (part.match(/^\d+$/)) {
                    translations.push(part + '‰∫∫Áß∞');
                } else {
                    // ËæûÊõ∏„Å´Ë¶ã„Å§„Åã„Çâ„Å™„ÅÑÂ†¥Âêà
                    allFound = false;
                    translations.push(part.toUpperCase());
                }
            }
            
            if (!allFound) {
                // ‰∏Ä„Å§„Åß„ÇÇË¶ã„Å§„Åã„Çâ„Å™„ÅÑ„Ç∞„É≠„Çπ„Åå„ÅÇ„Å£„ÅüÂ†¥Âêà
                return 'SearchGloss„Å´„Å™„Åó';
            }
            
            if (translations.length > 1) {
                return translations.join('„Éª');
            } else if (translations.length === 1) {
                return translations[0];
            } else {
                return 'SearchGloss„Å´„Å™„Åó';
            }
        }
        
        // SearchGloss„Åã„Çâ„Éá„Éº„Çø„ÇíÂèñÂæóÔºàÁèæÂú®„ÅØ‰ΩøÁî®„Åó„Å™„ÅÑÔºâ
        async function fetchFromSearchGloss(gloss) {
            // Â∞ÜÊù•ÁöÑ„Å´„Ç™„É≥„É©„Ç§„É≥„ÅÆSearchGloss„Å®ÈÄ£Êê∫„Åô„ÇãÂ†¥Âêà„ÅÆ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Éº
            return null;
        }
        
        // „Çπ„ÉÜ„Éº„Çø„Çπ„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
        function showStatus(message, type = 'info') {
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.textContent = message;
            statusMessage.className = 'status-message ' + type;
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusMessage.className = 'status-message';
                }, 5000);
            }
        }
        
        // HTML„Çí„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
        function downloadHTML() {
            // ÁèæÂú®„ÅÆ„Éö„Éº„Ç∏„ÅÆHTML„Çí„ÇØ„É≠„Éº„É≥
            const htmlClone = document.documentElement.cloneNode(true);
            
            // „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÂâäÈô§
            const uploadSection = htmlClone.querySelector('#uploadSection');
            if (uploadSection) {
                uploadSection.remove();
            }
            
            ytLinks.forEach(el => el.remove());
            
            // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíË°®Á§∫
            const contentSection = htmlClone.querySelector('#contentSection');
            if (contentSection) {
                contentSection.style.display = 'block';
            }
            
            // ‰æãÊñá„É™„Çπ„Éà„Çí„ÇØ„É™„Ç¢ÔºàJavaScript„ÅßÂÜçÁîüÊàê„Åô„Çã„Åü„ÇÅÔºâ
            const exampleList = htmlClone.querySelector('#exampleList');
            if (exampleList) {
                exampleList.innerHTML = '';
            }
            
            // „Çπ„ÇØ„É™„Éó„Éà„Çø„Ç∞„ÇíÊé¢„Åô
            const scripts = htmlClone.getElementsByTagName('script');
            let mainScript = null;
            
            for (let script of scripts) {
                if (script.textContent.includes('let examples = []')) {
                    mainScript = script;
                    break;
                }
            }
            
            if (mainScript) {
                // ÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÇíÂüã„ÇÅËæº„ÇÄ„Åü„ÇÅ„ÅÆÊñ∞„Åó„ÅÑ„Çπ„ÇØ„É™„Éó„Éà„Çí‰ΩúÊàê
                const dataScript = document.createElement('script');
                dataScript.textContent = `
                    // Âüã„ÇÅËæº„Åæ„Çå„Åü„Éá„Éº„Çø
                    window.embeddedData = {
                        examples: ${JSON.stringify(examples)},
                        audioUrls: ${JSON.stringify(audioUrls)},
                        fullAudioUrl: ${JSON.stringify(fullAudioUrl)}
                    };
                `;
                
                // „É°„Ç§„É≥„Çπ„ÇØ„É™„Éó„Éà„ÅÆÂâç„Å´„Éá„Éº„Çø„Çπ„ÇØ„É™„Éó„Éà„ÇíÊåøÂÖ•
                mainScript.parentNode.insertBefore(dataScript, mainScript);
                
                // „É°„Ç§„É≥„Çπ„ÇØ„É™„Éó„Éà„ÅÆÂÜÖÂÆπ„Çí‰øÆÊ≠£
                let scriptContent = mainScript.textContent;
                
                // processFilesÈñ¢Êï∞„Çí‰øÆÊ≠£ÔºàÂüã„ÇÅËæº„Åæ„Çå„Åü„Éá„Éº„Çø„Çí‰ΩøÁî®„Åô„Çã„Éê„Éº„Ç∏„Éß„É≥Ôºâ
                const modifiedProcessFiles = `
        // „Éï„Ç°„Ç§„É´„ÇíÂá¶ÁêÜÔºàÂüã„ÇÅËæº„Åø„Éá„Éº„ÇøÁâàÔºâ
        async function processFiles() {
            // Âüã„ÇÅËæº„Åæ„Çå„Åü„Éá„Éº„Çø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            if (window.embeddedData) {
                examples = window.embeddedData.examples;
                audioUrls = window.embeddedData.audioUrls;
                fullAudioUrl = window.embeddedData.fullAudioUrl;
                
                console.log('Âüã„ÇÅËæº„Åæ„Çå„Åü„Éá„Éº„Çø„Çí‰ΩøÁî®„Åó„Åæ„Åô');
                console.log(\`‰æãÊñáÊï∞: \${examples.length}\`);
                console.log(\`Èü≥Â£∞URLÊï∞: \${audioUrls.length}\`);
                
                // „Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíË°®Á§∫
                displayContent();
                
                // „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫
                const uploadSection = document.getElementById('uploadSection');
                if (uploadSection) {
                    uploadSection.style.display = 'none';
                }
                document.getElementById('contentSection').style.display = 'block';
                
                return;
            }
            
            // ÂÖÉ„ÅÆprocessFilesÈñ¢Êï∞„ÅÆ„Ç≥„Éº„Éâ
            `;
                
                // processFilesÈñ¢Êï∞„ÇíÁΩÆ„ÅçÊèõ„Åà
                scriptContent = scriptContent.replace(
                    /async function processFiles\(\) {/,
                    modifiedProcessFiles
                );
                
                // DOMContentLoadedÊôÇ„Å´Âüã„ÇÅËæº„Åø„Éá„Éº„Çø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                const initCode = `
        // DOM„ÅÆË™≠„ÅøËæº„ÅøÂÆå‰∫ÜÂæå„Å´ÂàùÊúüÂåñ
        window.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            
            // Âüã„ÇÅËæº„Åø„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØËá™ÂãïÁöÑ„Å´Âá¶ÁêÜ
            if (window.embeddedData) {
                processFiles();
            }
        });`;
                
                scriptContent = scriptContent.replace(
                    /\/\/ DOM„ÅÆË™≠„ÅøËæº„ÅøÂÆå‰∫ÜÂæå„Å´ÂàùÊúüÂåñ[\s\S]*?}\);/,
                    initCode
                );
                
                mainScript.textContent = scriptContent;
            }
            
            // HTML„ÇíÊñáÂ≠óÂàó„Å´Â§âÊèõ
            let htmlContent = '<!DOCTYPE html>\n' + htmlClone.outerHTML;
            
            htmlContent = htmlContent.split('\n').filter(line => {
            }).join('\n');
            
            // Blob„Çí‰ΩúÊàê
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            
            // „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„É™„É≥„ÇØ„Çí‰ΩúÊàê
            const downloadLink = document.createElement('a');
            downloadLink.href = URL.createObjectURL(blob);
            
            // „Éï„Ç°„Ç§„É´Âêç„ÇíË®≠ÂÆöÔºà„Çø„Ç§„Éà„É´„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„Åù„Çå„Çí‰ΩøÁî®Ôºâ
            const pageTitle = document.getElementById('pageTitle').textContent;
            const fileName = pageTitle !== '„Ç∞„É≠„Çπ‰ªò„Åç„ÉÜ„Ç≠„Çπ„Éà„Éì„É•„Éº„Ç¢' 
                ? `${pageTitle}.html` 
                : 'intex_output.html';
            
            downloadLink.download = fileName;
            
            // „É™„É≥„ÇØ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÇíÈñãÂßã
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            // „É°„É¢„É™„ÇíËß£Êîæ
            URL.revokeObjectURL(downloadLink.href);
            
            showStatus('HTML„Éï„Ç°„Ç§„É´„ÅÆ„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ„ÇíÈñãÂßã„Åó„Åæ„Åó„Åü', 'success');
        }
    </script>


</body></html>
